---
layout: post
title: "Publicar un servicio con dominio propio usando OPNsense"
date: 2025-12-28
categories: wiki.js, proxmox, opnsense, dns, proxy
---

## Publicar Wiki.js con dominio propio usando OPNsense

Este tutorial explica cÃ³mo exponer **Wiki.js** usando un **dominio propio**, apoyÃ¡ndonos en **OPNsense** como firewall, **HAProxy** como proxy inverso y **Unbound DNS** para la resoluciÃ³n interna de nombres.

El objetivo es acceder a nuestra wiki de forma cÃ³moda mediante una URL del tipo:

```
https://wiki.midominio.org
```

> âš ï¸ **Nota de privacidad**
> Los dominios, IPs y nombres usados aquÃ­ son ejemplos. SustitÃºyelos por los de tu propio entorno.

---

## ğŸ“Œ Punto de partida

### Infraestructura

* Dominio gestionado en **Cloudflare** (`midominio.org`)
* **Proxmox VE** como hipervisor
* Una **VM con OPNsense**
* Un **contenedor con Wiki.js** desplegado rÃ¡pidamente usando los scripts de la comunidad:

  * [https://community-scripts.github.io/ProxmoxVE/](https://community-scripts.github.io/ProxmoxVE/)

### ConfiguraciÃ³n previa en OPNsense

* Subred interna dedicada:

  * `192.168.10.0/24`
  * OPNsense: `192.168.10.1`
* **VPN WireGuard** para acceder a la red desde el exterior
* Certificado **Let's Encrypt** generado con el mÃ³dulo **ACME Client**, validado mediante Cloudflare

> ğŸ’¡ Si te interesa un tutorial especÃ­fico sobre **WireGuard**, **ACME Client**, **HAProxy** o **Unbound**, comÃ©ntamelo.

---

## ğŸ¯ Objetivo

Configurar:

1. **HAProxy** para enrutar el trÃ¡fico HTTPS hacia Wiki.js
2. **Unbound DNS** para resolver el dominio internamente

---

## ğŸ”€ 1. ConfiguraciÃ³n de HAProxy

### 1.1 Crear el *Real Server*

Ruta:

```
HAProxy â†’ Settings â†’ Real Servers
```

ConfiguraciÃ³n:

* âœ… **Enable**
* **Name / Prefix**: `Wiki_RealServer`
* **FQDN or IP**: `192.168.10.88` (IP del contenedor Wiki.js)
* **Port**: `3000` (puerto por defecto de Wiki.js)

Guardar y aplicar cambios.

---

### 1.2 Crear la condiciÃ³n (*Condition*)

Ruta:

```
HAProxy â†’ Settings â†’ Rules & Checks â†’ Conditions
```

ConfiguraciÃ³n:

* **Name**: `Host_wiki`
* **Condition type**: `Host matches`
* **Host string**: `wiki.midominio.org`

Guardar y aplicar cambios.

---

### 1.3 Crear el *Backend Pool*

Ruta:

```
HAProxy â†’ Settings â†’ Virtual Services â†’ Backend Pools
```

ConfiguraciÃ³n:

* **Name**: `Wiki_Backend`
* **Servers**: `Wiki_RealServer`

Guardar y aplicar cambios.

---

### 1.4 Crear la regla de enrutado

Ruta:

```
HAProxy â†’ Settings â†’ Rules & Checks â†’ Rules
```

ConfiguraciÃ³n:

* **Name**: `Rule_wiki`
* **Conditions**: `Host_wiki`
* **Use backend pool**: `Wiki_Backend`

Guardar y aplicar cambios.

---

## ğŸŒ 2. ConfiguraciÃ³n de Unbound DNS

Para que el dominio se resuelva **dentro de la red** (y por VPN), creamos un override.

Ruta:

```
Unbound DNS â†’ Overrides
```

ConfiguraciÃ³n:

* âœ… **Enable**
* **Host**: `wiki`
* **Domain**: `midominio.org`
* **Type**: `IPv4`
* **IP address**: `192.168.10.1` (IP de OPNsense / HAProxy)

Guardar y aplicar cambios.

---

## ğŸ–¥ï¸ 3. Archivo `/etc/hosts` (opcional pero Ãºtil)

En clientes donde no quieras depender del DNS (o para pruebas rÃ¡pidas), puedes aÃ±adir:

```text
192.168.10.1 wiki.midominio.org
```

---

## âœ… Resultado final

ğŸ‰ Ya puedes acceder a tu Wiki.js desde el navegador usando:

```
https://wiki.midominio.org
```

* Accesible desde la LAN
* Accesible desde fuera mediante VPN
* Con HTTPS vÃ¡lido gracias a Let's Encrypt

---
*Formateado a markdown con ChatGPT*
